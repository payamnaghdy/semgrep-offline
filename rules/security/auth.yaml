rules:
  - id: django-csrf-exempt
    pattern: "@csrf_exempt"
    message: "CSRF protection is disabled for this view. Ensure this is intentional and the endpoint is protected by other means."
    languages: [python]
    severity: WARNING
    metadata:
      cwe: "CWE-352"
      owasp: "A01:2021 - Broken Access Control"

  - id: django-session-cookie-insecure
    pattern: SESSION_COOKIE_SECURE = False
    message: "Session cookies are not secure. Set SESSION_COOKIE_SECURE = True in production."
    languages: [python]
    severity: WARNING
    metadata:
      cwe: "CWE-614"
      owasp: "A02:2021 - Cryptographic Failures"

  - id: django-csrf-cookie-insecure
    pattern: CSRF_COOKIE_SECURE = False
    message: "CSRF cookies are not secure. Set CSRF_COOKIE_SECURE = True in production."
    languages: [python]
    severity: WARNING
    metadata:
      cwe: "CWE-614"
      owasp: "A02:2021 - Cryptographic Failures"

  - id: django-password-validators-empty
    pattern: AUTH_PASSWORD_VALIDATORS = []
    message: "Password validators are disabled. Enable Django's built-in password validators."
    languages: [python]
    severity: WARNING
    metadata:
      cwe: "CWE-521"
      owasp: "A07:2021 - Identification and Authentication Failures"

  - id: jwt-no-verify
    patterns:
      - pattern: jwt.decode(..., verify=False, ...)
      - pattern: jwt.decode(..., options={"verify_signature": False}, ...)
      - pattern: jwt.decode(..., options={..., "verify_signature": False, ...}, ...)
    message: "JWT signature verification is disabled. This is insecure."
    languages: [python]
    severity: ERROR
    metadata:
      cwe: "CWE-347"
      owasp: "A02:2021 - Cryptographic Failures"

  - id: jwt-algorithm-none
    pattern: jwt.encode(..., algorithm="none", ...)
    message: "JWT with algorithm 'none' has no security. Use HS256 or RS256."
    languages: [python]
    severity: ERROR
    metadata:
      cwe: "CWE-327"
      owasp: "A02:2021 - Cryptographic Failures"

  - id: ssl-unverified
    patterns:
      - pattern: ssl._create_unverified_context()
      - pattern: requests.$METHOD(..., verify=False, ...)
      - pattern: urllib3.disable_warnings(...)
    message: "SSL certificate verification is disabled. This is insecure for production."
    languages: [python]
    severity: ERROR
    metadata:
      cwe: "CWE-295"
      owasp: "A07:2021 - Identification and Authentication Failures"

  - id: django-mass-assignment
    patterns:
      - pattern: $MODEL.objects.create(**request.POST)
      - pattern: $MODEL.objects.create(**request.data)
      - pattern: $MODEL(**request.POST)
      - pattern: $MODEL(**request.data)
    message: "Mass assignment vulnerability. Explicitly specify allowed fields instead of passing request data directly."
    languages: [python]
    severity: ERROR
    metadata:
      cwe: "CWE-915"
      owasp: "A04:2021 - Insecure Design"
